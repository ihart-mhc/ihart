/*** This file holds the Magic 8 Ball Screen and will update the textbox**/package{	import flash.display.*;	import flash.utils.Timer;	import ihart.event.*;	import flash.events.*;	import flash.text.TextField;	import flash.text.*;	import flash.text.engine.TextBaseline;		import flash.media.Sound;	import flash.media.SoundChannel;	import flash.net.URLRequest;		//for the shaking ball	import flash.geom.Point;		public class UpdateMagic8 extends MovieClip {		//Ball		private var ball: Ball;		//Timer		private var cvTimer: Timer; 		private var timerTicks: int; 		//Sounds		private var played: Boolean;  		private var glassSound:Sound;		// iHart		private var sayings : Array; 		private var saying: String; 		private var output: TextField;		private var format: TextFormat;		private var cvManager: CVManager; 		private var port:uint = 5204; 		private var hostName:String = "localhost"; 				// Screensaver to be displayed when no movement is detected		private var screensaver:Screensaver;	//intializes variables; calls functions that initialize variables	public function UpdateMagic8() : void 	{		//initialize ball		//make a new ball type Ball		ball = new Ball();		//set property of the instance		ball.x = 270;		ball.y = 200;		//add to the screen		addChild(ball);		//initialize textfield		output = new TextField();		format = new TextFormat(); 		addChild(output); 		setUpText();		//initialize sound		glassSound = new Sound(new URLRequest("glass.mp3"));		played = false;		//initialize var needed for iHart		cvManager = new CVManager(hostName, port); 		cvManager.addEventListener(CVEvent.SHELL, getData); 		//initialize variables needed for the timer		timerTicks = 0; 		setupTimer();				// Initialize the screensaver		screensaver = new Screensaver();		addChild(screensaver);	}	//sets up textfield (position; size; color; opacity)	private function setUpText():void 	{		//initialize format 		format.size = 25; 		format.bold = true; 		format.align = TextFormatAlign.CENTER;				//set position of the textfield		output.defaultTextFormat = format; 		output.x = 200; 		output.y = 180; 	    //dynamic textfield		output.wordWrap = true; 		output.selectable= false; 		//set's size of text field		output.width = 150; 		output.height = 100;		//set color and opacity of textfield		output.textColor = 0xFF0000; 		output.alpha = .4; 				//initial text		this.output.text = "Ask!"; //initial placeholder text			}		//sets up timer	private function setupTimer(): void	{		cvTimer = new Timer(1000, 1); 		cvTimer.addEventListener(TimerEvent.TIMER, allowCVEvents); 		cvTimer.start(); //start timer		saying = ballSpeaks(); //stores a random saying 	}		//called with the cvTimer	private function allowCVEvents(e: Event) : void 	{		timerTicks++; //increment number of ticks by 1	}		//called when motion detected 	public function getData(e: CVEvent):void{				//use this to add an instruction screen		var numBlobs : int = e.getNumBlobs();		if(numBlobs > 0)		{			//removeChild(screensaver);		}		cvTimer.start();		if(timerTicks > 1 && timerTicks < 3)		{			//set text to 'ball is thinking'			this.output.text = "Ball is thinking..."; 		}		else if(timerTicks >= 3 && timerTicks < 5)		{			//set text to 'shake harder'			this.output.text = "Shake Harder!";		}		//(this is where the magic happens)		else if(timerTicks >= 5 && timerTicks < 8)		{			//set output text: random saying from the array			this.output.text = saying; 			//change the text color to blue			output.textColor = 0x00FFFF;			//this ensures the sound only plays once			if(timerTicks == 5 && !played)			{					played = true 				//plays sound				glassSound.play();			}		}		//if timer ticks > 8, reset everything		else if(timerTicks >= 8)		{			output.text = "Ask!"; //set text back to 'Ask!'			output.textColor = 0xFF0000; //reset text color back to red			resetTimer(); //reset timer 		}	}		//mouse clicked	public function mouseClicked ( e : MouseEvent) :void 	{		timerTicks++; //similar to the allow cv events fn.	}			// returns random phrase from an array containing all possible answers	public function ballSpeaks(): String	{		sayings = new Array ("It is certain", "In Your Dreams", "Without a doubt", "Yes, definitely", "You may rely on it", "You Wish", "Most likely", "Outlook good", "Yes", "Signs point to yes", "Reply hazy, try again", "Ask again later", "Better not tell you now", "Cannot predict now", "Concentrate and ask again", "Don't count on it", "Not a chance", "My sources say no", "Outlook not so good", "Very doubtful");				var r: int = Math.floor(Math.random() * sayings.length);		shakeBall(ball, 100, 15);		return sayings[r];	}			//Stops timer, sets up new timer Resets timer clicks; 		public function resetTimer():void		{			cvTimer.stop();			timerTicks = 0;			setupTimer(); 			//set sound played to fase			played = false; 			}			/*//this function should be invoked when there's blob detected		public function shakeBall():void		{			//assign move of ball			var ballMove: Number = 0.2;			//generate random move			var randomMove: int = Math.random()*10;						//shake the ball			for (var i: int = 0; i <100; i++)			{				//move the ball to the left, right, up, down				ball.x -= ballMove/2;				ball.x += ballMove;				ball.y -= ballMove;				ball.y += ballMove;				i++;			}		}*/				public function shakeBall(mc:MovieClip, frames:int = 10, maxShakeAmount:int = 30) : void 		{			if (!mc._shakeTime || mc._shakeTime <= 0)			{				mc.startPosition = new Point(mc.x, mc.y);				mc._shakeTime = frames;				mc._maxShakeAmount = maxShakeAmount;				mc.addEventListener(Event.ENTER_FRAME, handleShakeEnterFrame);			}			else			{				mc.startPosition = new Point(mc.x, mc.y);				mc._shakeTime += frames;				mc._maxShakeAmount = maxShakeAmount;			}		}				public function handleShakeEnterFrame(event:Event):void		{			var mc:MovieClip = MovieClip(event.currentTarget);			var shakeAmount:Number = Math.min(mc._maxShakeAmount, mc._shakeTime);			mc.x = mc.startPosition.x + (-shakeAmount / 2 + Math.random() * shakeAmount);			mc.y = mc.startPosition.y + (-shakeAmount / 2 + Math.random() * shakeAmount);					mc._shakeTime--;					if (mc._shakeTime <= 0)			{				mc._shakeTime = 0;				mc.removeEventListener(Event.ENTER_FRAME, handleShakeEnterFrame);			}		}	}}